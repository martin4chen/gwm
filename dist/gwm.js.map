{"version":3,"file":"gwm.js","sources":["../lib/watermark.js","../lib/core/canvas.js","../lib/helpers/bindCSS.js","../lib/core/element.js","../lib/core/svg.js","../lib/index.js"],"sourcesContent":["export default class Watermark {\n    constructor({\n                    txt = '',\n                    x = 0,\n                    y = 50,\n                    font = 'microsoft yahe',\n                    color = '#000',\n                    fontSize = 12,\n                    alpha = 1,\n                    width = 158,\n                    height = 100,\n                    angle = -15\n                }) {\n        this.txt = txt || '内部资料 请勿外传'\n        this.width = width\n        this.height = height\n        this.x = x\n        this.y = y\n        this.font = font\n        this.fontSize = fontSize\n        this.color = color\n        this.alpha = alpha\n        this.angle = angle\n    }\n}","export default class CanvasWay {\n    constructor(watermark) {\n        this.watermark = watermark\n        const {width, height} = watermark\n        this.canvas = document.createElement('canvas');\n        this.canvas.setAttribute('width', width);\n        this.canvas.setAttribute('height', height);\n    }\n\n    render() {\n        const {txt, x, y, width, height, font, color, fontSize, alpha, angle} = this.watermark\n        const ctx = this.canvas.getContext('2d');\n        ctx.clearRect(0, 0, width, height);\n        ctx.textBaseline = 'top';\n        ctx.textAlign = 'left'\n        ctx.fillStyle = color;\n        ctx.globalAlpha = alpha;\n        ctx.font = `${fontSize}px ${font}`\n        ctx.translate(x, y)\n        ctx.rotate(Math.PI / 180 * angle);\n        ctx.translate(-x, -y - fontSize)\n        ctx.fillText(txt, x, y + fontSize);\n        return this.canvas.toDataURL();\n    }\n}","function setStyle(elem, key, value) {\n    elem.style[key] = value\n}\n\nexport default (elem, css) => Object.keys(css).forEach(key => setStyle(elem, key, css[key]))","import bindCSS from '../helpers/bindCSS'\n\nexport default class ElementWay {\n    constructor(watermark) {\n        this.watermark = watermark\n    }\n\n    _createItem() {\n        let {txt, x, y, font, color, fontSize, alpha, angle, width, height} = this.watermark\n        const item = document.createElement('div');\n        bindCSS(item, {\n            position: 'relative',\n            width, height,\n            flex: `0 0 ${width}px`,\n            overflow: 'hidden',\n            pointerEvents: 'none'\n        })\n        let span = document.createElement('span');\n        span.innerHTML = txt\n        bindCSS(span, {\n            position: 'absolute',\n            top: `${y}px`,\n            left: `${x}px`,\n            fontFamily: font,\n            fontSize: `${fontSize}px`,\n            color: color,\n            lineHeight: 1.5,\n            opacity: alpha,\n            fontWeight: 400,\n            transform: `rotate(${angle}deg)`,\n            transformOrigin: '0 0',\n            userSelect: 'none',\n            whiteSpace: 'nowrap',\n            overflow: 'hidden'\n        })\n        item.appendChild(span)\n        return item;\n    }\n\n    render() {\n        const {width, height} = this.watermark\n        const {clientWidth, clientHeight} = document.documentElement || document.body\n        const column = Math.ceil(clientWidth / width)\n        const rows = Math.ceil(clientHeight / height)\n        const wrap = document.createElement('div');\n        bindCSS(wrap, {\n            display: 'flex',\n            flexWrap: 'wrap',\n            width: `${width * column}px`,\n            height: `${height * rows}px`\n        })\n        for (let i = 0; i < column * rows; i++) {\n            wrap.appendChild(this._createItem());\n        }\n        return wrap;\n    }\n}","export default class SvgWay {\n    constructor(watermark) {\n        this.watermark = watermark\n    }\n\n    render() {\n        const {txt, x, y, width, height, color, font, fontSize, alpha, angle} = this.watermark\n        const svgStr =\n            `<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"${width}px\" height=\"${height}px\">\n                <text x=\"${x}px\" y=\"${y}px\" dy=\"${fontSize}px\"\n                    text-anchor=\"start\"\n                    stroke=\"${color}\"\n                    stroke-opacity=\"${alpha}\"\n                    fill=\"none\"\n                    transform=\"rotate(${angle},${x} ${y})\"\n                    font-weight=\"100\"\n                    font-size=\"${fontSize}\"\n                    font-family=\"${font}\"\n                    >\n                    ${txt}\n                </text>\n            </svg>`;\n        return `data:image/svg+xml;base64,${window.btoa(unescape(encodeURIComponent(svgStr)))}`;\n    }\n}","import Watermark from './watermark'\nimport CanvasWay from './core/canvas'\nimport ElementWay from './core/element'\nimport SvgWay from './core/svg.js'\n\n\nfunction getGwm() {\n    const gwmDiv = document.createElement('div');\n    const gwmStyle = {\n        position: 'absolute',\n        top: 0,\n        right: 0,\n        bottom: 0,\n        left: 0,\n        width: '178px',\n        height: '120px',\n        overflow: 'hidden',\n        backgroundRepeat: 'no-repeat'\n    }\n    for (let key in gwmStyle) {\n        gwmDiv.style[key] = gwmStyle[key]\n    }\n    return gwmDiv\n}\n\n\nconst w = new Watermark({\n    width: 178,\n    height: 120,\n    txt: '20180727 内部资料 请勿外传', angle: -15,\n    x: 10, y: 60,\n    color: '#ff0000'\n})\n//\nconst img = new CanvasWay(w).render()\nconst gwm1 = getGwm()\ngwm1.style.backgroundImage = `url(\"${img}\")`\ndocument.body.appendChild(gwm1)\n\n// success\nw.color = '#2196f3'\nw.txt = '20180727 内部资料 请勿'\nconst img2 = new SvgWay(w).render()\nconst gwm2 = getGwm()\ngwm2.style.backgroundImage = `url(\"${img2}\")`\ndocument.body.appendChild(gwm2)\n\n\nw.color = '#000'\nw.txt = '20180727 内部资料'\nconst elementWay = new ElementWay(w)\nconst gwm3 = getGwm()\ngwm3.appendChild(elementWay.render())\ndocument.body.appendChild(gwm3)"],"names":["Watermark","txt","x","y","font","color","fontSize","alpha","width","height","angle","CanvasWay","watermark","canvas","document","createElement","setAttribute","ctx","getContext","clearRect","textBaseline","textAlign","fillStyle","globalAlpha","translate","rotate","Math","PI","fillText","toDataURL","setStyle","elem","key","value","style","css","Object","keys","forEach","ElementWay","item","span","innerHTML","appendChild","documentElement","body","clientWidth","clientHeight","column","ceil","rows","wrap","i","_createItem","SvgWay","svgStr","window","btoa","unescape","encodeURIComponent","getGwm","gwmDiv","gwmStyle","w","img","render","gwm1","backgroundImage","img2","gwm2","elementWay","gwm3"],"mappings":"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"}