{"version":3,"file":"gwm.js","sources":["../lib/helpers/dateConvert.js","../lib/watermark.js","../lib/core/canvas.js","../lib/helpers/bindCSS.js","../lib/core/element.js","../lib/core/svg.js","../lib/helpers/creator.js","../lib/index.js"],"sourcesContent":["const now = new Date()\nconst fullYear = now.getFullYear()\nconst month = now.getMonth() >= 9 ? now.getMonth() + 1 : `0${now.getMonth() + 1}`\nconst date = now.getDate()\n\nexport default () => `${fullYear}${month}${date}`","import dateConvert from './helpers/dateConvert'\n\nexport default class Watermark {\n    constructor({\n                    txt = '',\n                    x = 0,\n                    y = 50,\n                    font = 'microsoft yahe',\n                    color = '#000',\n                    fontSize = 12,\n                    alpha = 1,\n                    width = 158,\n                    height = 100,\n                    angle = -15\n                }) {\n        this.txt = txt || `${dateConvert()} 内部资料 请勿外传`\n        this.width = width\n        this.height = height\n        this.x = x\n        this.y = y\n        this.font = font\n        this.fontSize = fontSize\n        this.color = color\n        this.alpha = alpha\n        this.angle = angle\n    }\n}","export default class CanvasWay {\n    constructor(watermark) {\n        this.watermark = watermark\n        const {width, height} = watermark\n        this.canvas = document.createElement('canvas');\n        this.canvas.setAttribute('width', width);\n        this.canvas.setAttribute('height', height);\n    }\n\n    render() {\n        const {txt, x, y, width, height, font, color, fontSize, alpha, angle} = this.watermark\n        const ctx = this.canvas.getContext('2d');\n        ctx.clearRect(0, 0, width, height);\n        ctx.textBaseline = 'top';\n        ctx.textAlign = 'left'\n        ctx.fillStyle = color;\n        ctx.globalAlpha = alpha;\n        ctx.font = `${fontSize}px ${font}`\n        ctx.translate(x, y)\n        ctx.rotate(Math.PI / 180 * angle);\n        ctx.translate(-x, -y - fontSize)\n        ctx.fillText(txt, x, y + fontSize);\n        return this.canvas.toDataURL();\n    }\n}","function setStyle(elem, key, value) {\n    elem.style[key] = value\n}\n\nexport default (elem, css) => Object.keys(css).forEach(key => setStyle(elem, key, css[key]))","import bindCSS from '../helpers/bindCSS'\n\nexport default class ElementWay {\n    constructor(watermark) {\n        this.watermark = watermark\n    }\n\n    _createItem() {\n        let {txt, x, y, font, color, fontSize, alpha, angle, width, height} = this.watermark\n        const item = document.createElement('div');\n        bindCSS(item, {\n            position: 'relative',\n            width, height,\n            flex: `0 0 ${width}px`,\n            overflow: 'hidden',\n            pointerEvents: 'none'\n        })\n        let span = document.createElement('span');\n        span.innerHTML = txt\n        bindCSS(span, {\n            position: 'absolute',\n            top: `${y}px`,\n            left: `${x}px`,\n            fontFamily: font,\n            fontSize: `${fontSize}px`,\n            color: color,\n            lineHeight: 1.5,\n            opacity: alpha,\n            fontWeight: 400,\n            transform: `rotate(${angle}deg)`,\n            transformOrigin: '0 0',\n            userSelect: 'none',\n            whiteSpace: 'nowrap',\n            overflow: 'hidden'\n        })\n        item.appendChild(span)\n        return item;\n    }\n\n    render() {\n        const {width, height} = this.watermark\n        const {clientWidth, clientHeight} = document.documentElement || document.body\n        const column = Math.ceil(clientWidth / width)\n        const rows = Math.ceil(clientHeight / height)\n        const wrap = document.createElement('div');\n        bindCSS(wrap, {\n            display: 'flex',\n            flexWrap: 'wrap',\n            width: `${width * column}px`,\n            height: `${height * rows}px`\n        })\n        for (let i = 0; i < column * rows; i++) {\n            wrap.appendChild(this._createItem());\n        }\n        return wrap;\n    }\n}","export default class SvgWay {\n    constructor(watermark) {\n        this.watermark = watermark\n    }\n\n    render() {\n        const {txt, x, y, width, height, color, font, fontSize, alpha, angle} = this.watermark\n        const svgStr =\n            `<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"${width}px\" height=\"${height}px\">\n                <text x=\"${x}px\" y=\"${y}px\" dy=\"${fontSize}px\"\n                    text-anchor=\"start\"\n                    stroke=\"${color}\"\n                    stroke-opacity=\"${alpha}\"\n                    fill=\"none\"\n                    transform=\"rotate(${angle},${x} ${y})\"\n                    font-weight=\"100\"\n                    font-size=\"${fontSize}\"\n                    font-family=\"${font}\"\n                    >\n                    ${txt}\n                </text>\n            </svg>`;\n        return `data:image/svg+xml;base64,${window.btoa(unescape(encodeURIComponent(svgStr)))}`;\n    }\n}","import bindCSS from './bindCSS'\n\nexport default () => {\n    const gwmDiv = document.createElement('div');\n    bindCSS(gwmDiv, {\n        position: 'fixed',\n        top: 0,\n        left: 0,\n        width: '100%',\n        height: '100%',\n        overflow: 'hidden',\n        backgroundRepeat: 'no-repeat'\n    })\n    return gwmDiv\n}","import Watermark from './watermark'\nimport CanvasWay from './core/canvas'\nimport ElementWay from './core/element'\nimport SvgWay from './core/svg.js'\nimport creator from './helpers/creator'\n\n(function () {\n    const CANVAS = 'canvas'\n    const SVG = 'svg'\n    const ELEMENT = 'element'\n\n    const creation = opts => {\n        const way = [CANVAS, SVG, ELEMENT]\n        const gwm = creator()\n        const wm = new Watermark(opts)\n        let impl = null\n        let result = null\n        let {mode} = opts\n        if (mode) {\n            mode = mode.toLowerCase()\n            mode = way.indexOf(mode) >= 0 ? mode : ''\n        }\n        if (!mode) {\n            mode = 'canvas'\n        }\n        switch (mode) {\n            case CANVAS:\n                impl = new CanvasWay(wm)\n                break\n            case SVG:\n                impl = new SvgWay(wm)\n                break\n            default:\n                impl = new ElementWay(wm)\n        }\n        result = impl.render()\n        if (mode === ELEMENT) {\n            gwm.appendChild(result)\n        } else {\n            gwm.style.background = `url(\"${result}\")`\n        }\n        document.body.appendChild(gwm)\n    }\n\n    window.gwm = creation\n})()"],"names":["now","Date","fullYear","getFullYear","month","getMonth","date","getDate","Watermark","txt","x","y","font","color","fontSize","alpha","width","height","angle","dateConvert","CanvasWay","watermark","canvas","document","createElement","setAttribute","ctx","getContext","clearRect","textBaseline","textAlign","fillStyle","globalAlpha","translate","rotate","Math","PI","fillText","toDataURL","setStyle","elem","key","value","style","css","Object","keys","forEach","ElementWay","item","span","innerHTML","appendChild","documentElement","body","clientWidth","clientHeight","column","ceil","rows","wrap","i","_createItem","SvgWay","svgStr","window","btoa","unescape","encodeURIComponent","gwmDiv","CANVAS","SVG","ELEMENT","creation","way","gwm","creator","wm","opts","impl","result","mode","toLowerCase","indexOf","render","background"],"mappings":"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"}