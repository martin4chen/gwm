!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.gwm=t()}(this,function(){"use strict";var e=new Date,D=e.getFullYear(),M=9<=e.getMonth()?e.getMonth()+1:"0"+(e.getMonth()+1),k=10<=e.getDate()?e.getDate():"0"+e.getDate(),O=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},n=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}(),s=function e(t){var n=t.txt,r=void 0===n?""+D+M+k+" 内部资料 请勿外传":n,o=t.x,i=void 0===o?0:o,a=t.y,s=void 0===a?50:a,c=t.font,d=void 0===c?"microsoft yahe":c,h=t.color,u=void 0===h?"#000":h,f=t.fontSize,l=void 0===f?12:f,v=t.alpha,m=void 0===v?.1:v,p=t.width,g=void 0===p?158:p,w=t.height,b=void 0===w?100:w,x=t.angle,y=void 0===x?-15:x;O(this,e),this.txt=r,this.width=g,this.height=b,this.x=i,this.y=s,this.font=d,this.fontSize=l,this.color=u,this.alpha=m,this.angle=y},c=function(){function r(e){O(this,r);var t=(this.watermark=e).width,n=e.height;this.canvas=document.createElement("canvas"),this.canvas.setAttribute("width",t),this.canvas.setAttribute("height",n)}return n(r,[{key:"render",value:function(){var e=this.watermark,t=e.txt,n=e.x,r=e.y,o=e.width,i=e.height,a=e.font,s=e.color,c=e.fontSize,d=e.alpha,h=e.angle,u=this.canvas.getContext("2d");return u.clearRect(0,0,o,i),u.textBaseline="top",u.textAlign="left",u.fillStyle=s,u.globalAlpha=d,u.font=c+"px "+a,u.translate(n,r),u.rotate(Math.PI/180*h),u.translate(-n,-r-c),u.fillText(t,n,r+c),this.canvas.toDataURL()}}]),r}();var l=function(o,i){return Object.keys(i).forEach(function(e){return t=o,r=i[n=e],void(t.style[n]=r);var t,n,r})};var d=function(){function t(e){O(this,t),this.watermark=e}return n(t,[{key:"_createItem",value:function(){var e=this.watermark,t=e.txt,n=e.x,r=e.y,o=e.font,i=e.color,a=e.fontSize,s=e.alpha,c=e.angle,d=e.width,h=e.height,u=document.createElement("div");l(u,{position:"relative",width:d,height:h,flex:"0 0 "+d+"px",overflow:"hidden",pointerEvents:"none"});var f=document.createElement("span");return f.innerHTML=t,l(f,{position:"absolute",top:r+"px",left:n+"px",fontFamily:o,fontSize:a+"px",color:i,lineHeight:1.5,opacity:s,fontWeight:400,transform:"rotate("+c+"deg)",transformOrigin:"0 0",userSelect:"none",whiteSpace:"nowrap",overflow:"hidden"}),u.appendChild(f),u}},{key:"render",value:function(){var e=this.watermark,t=e.width,n=e.height,r=document.documentElement||document.body,o=r.clientWidth,i=r.clientHeight,a=Math.ceil(o/t),s=Math.ceil(i/n),c=document.createElement("div");l(c,{display:"flex",flexWrap:"wrap",width:t*a+"px",height:n*s+"px"});for(var d=0;d<a*s;d++)c.appendChild(this._createItem());return c}}]),t}(),h=function(){function t(e){O(this,t),this.watermark=e}return n(t,[{key:"render",value:function(){var e=this.watermark,t=e.txt,n=e.x,r=e.y,o=e.width,i=e.height,a=e.color,s=e.font,c=e.fontSize,d='<svg xmlns="http://www.w3.org/2000/svg" width="'+o+'px" height="'+i+'px">\n                <text x="'+n+'px" y="'+r+'px" dy="'+c+'px"\n                    text-anchor="start"\n                    stroke="'+a+'"\n                    stroke-opacity="'+e.alpha+'"\n                    fill="none"\n                    transform="rotate('+e.angle+","+n+" "+r+')"\n                    font-weight="100"\n                    font-size="'+c+'"\n                    font-family="'+s+'"\n                    >\n                    '+t+"\n                </text>\n            </svg>";return"data:image/svg+xml;base64,"+window.btoa(unescape(encodeURIComponent(d)))}}]),t}(),i="__gwm_"+ +new Date,u=window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver;var r=function(t,e,n){if(!u)return r=t,o=e,i=n,(a=["DOMAttrModified","DOMAttributeNameChanged","DOMCharacterDataModified","DOMElementNameChanged","DOMNodeInserted","DOMNodeInsertedIntoDocument","DOMNodeRemoved","DOMNodeRemovedFromDocument","DOMSubtreeModified"]).map(function(e){return r.addEventListener(e,function(){return i()},!1)}),document.body.addEventListener("DOMSubtreeModified",function(){return i()},!1),{containerObserver:{disconnect:function(){return o.removeEventListener("DOMSubtreeModified",function(){return i()},!1)}},observer:{disconnect:function(){return a.map(function(e){return r.removeEventListener(e,function(){return i()},!1)})}}};var r,o,i,a,s=new u(function(e){return e.forEach(function(e){return e.removedNodes.forEach(function(e){return e===t&&n()})})});s.observe(e,{childList:!0});var c=new u(n);return c.observe(t,{characterData:!0,attributes:!0,childList:!0,subtree:!0}),{containerObserver:s,observer:c}},f=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.gwmDom,n=e.opts.css,r=t||document.getElementById(i);r&&r.remove();var o=document.createElement("div");return"pointerEvents"in document.documentElement.style&&(n.pointerEvents="none",n.zIndex=999999),l(o,n),o.id=i,o},v="canvas",m="element";return new(function(){function e(){O(this,e)}return n(e,[{key:"creation",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};e.css||(e.css={position:"fixed",top:0,right:0,bottom:0,left:0,overflow:"hidden",zIndex:-10,backgroundRepeat:"no-repeat"}),this.opts=e,this.cancel();var t=e.mode,n=e.watch,r=e.container,o=void 0===r?document.body:r;this.gwmDom=f(this);var i=function(e,t){var n=[v,"svg",m],r=null;switch(e&&(e=e.toLowerCase(),e=0<=n.indexOf(e)?e:""),e||(e="svg"),e){case v:r=new c(t);break;case"svg":r=new h(t);break;default:r=new d(t)}return r}(t,new s(e)).render();t===m?this.gwmDom.appendChild(i):this.gwmDom.style.background='url("'+i+'")';var a=o.firstChild;a?o.insertBefore(this.gwmDom,a):o.appendChild(this.gwmDom),!1!==n&&(this.observer=this.observing())}},{key:"observing",value:function(){var e=this,t=this.opts.container,n=void 0===t?document.body:t;return r(this.gwmDom,n,function(){return e.creation(e.opts)})}},{key:"cancel",value:function(){var e,t,n;this.observer&&(e=this.observer,t=e.containerObserver,n=e.observer,t.disconnect()&&n.disconnect())}}]),e}())});
