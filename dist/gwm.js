!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.gwm=t()}(this,function(){"use strict";var e=new Date,D=e.getFullYear(),M=9<=e.getMonth()?e.getMonth()+1:"0"+(e.getMonth()+1),k=10<=e.getDate()?e.getDate():"0"+e.getDate(),O=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},n=function(){function o(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(e,t,n){return t&&o(e.prototype,t),n&&o(e,n),e}}(),i=function e(t){var n=t.txt,o=void 0===n?""+D+M+k+" 内部资料 请勿外传":n,r=t.x,i=void 0===r?0:r,a=t.y,d=void 0===a?50:a,s=t.font,c=void 0===s?"microsoft yahe":s,u=t.color,h=void 0===u?"#000":u,f=t.fontSize,l=void 0===f?12:f,v=t.alpha,m=void 0===v?.1:v,g=t.width,w=void 0===g?158:g,p=t.height,b=void 0===p?100:p,y=t.angle,x=void 0===y?-15:y;O(this,e),this.txt=o,this.width=w,this.height=b,this.x=i,this.y=d,this.font=c,this.fontSize=l,this.color=h,this.alpha=m,this.angle=x},a=function(){function o(e){O(this,o);var t=(this.watermark=e).width,n=e.height;this.canvas=document.createElement("canvas"),this.canvas.setAttribute("width",t),this.canvas.setAttribute("height",n)}return n(o,[{key:"render",value:function(){var e=this.watermark,t=e.txt,n=e.x,o=e.y,r=e.width,i=e.height,a=e.font,d=e.color,s=e.fontSize,c=e.alpha,u=e.angle,h=this.canvas.getContext("2d");return h.clearRect(0,0,r,i),h.textBaseline="top",h.textAlign="left",h.fillStyle=d,h.globalAlpha=c,h.font=s+"px "+a,h.translate(n,o),h.rotate(Math.PI/180*u),h.translate(-n,-o-s),h.fillText(t,n,o+s),this.canvas.toDataURL()}}]),o}();var l=function(r,i){return Object.keys(i).forEach(function(e){return t=r,o=i[n=e],void(t.style[n]=o);var t,n,o})};var d=function(){function t(e){O(this,t),this.watermark=e}return n(t,[{key:"_createItem",value:function(){var e=this.watermark,t=e.txt,n=e.x,o=e.y,r=e.font,i=e.color,a=e.fontSize,d=e.alpha,s=e.angle,c=e.width,u=e.height,h=document.createElement("div");l(h,{position:"relative",width:c,height:u,flex:"0 0 "+c+"px",overflow:"hidden",pointerEvents:"none"});var f=document.createElement("span");return f.innerHTML=t,l(f,{position:"absolute",top:o+"px",left:n+"px",fontFamily:r,fontSize:a+"px",color:i,lineHeight:1.5,opacity:d,fontWeight:400,transform:"rotate("+s+"deg)",transformOrigin:"0 0",userSelect:"none",whiteSpace:"nowrap",overflow:"hidden"}),h.appendChild(f),h}},{key:"render",value:function(){var e=this.watermark,t=e.width,n=e.height,o=document.documentElement||document.body,r=o.clientWidth,i=o.clientHeight,a=Math.ceil(r/t),d=Math.ceil(i/n),s=document.createElement("div");l(s,{display:"flex",flexWrap:"wrap",width:t*a+"px",height:n*d+"px"});for(var c=0;c<a*d;c++)s.appendChild(this._createItem());return s}}]),t}(),s=function(){function t(e){O(this,t),this.watermark=e}return n(t,[{key:"render",value:function(){var e=this.watermark,t=e.txt,n=e.x,o=e.y,r=e.width,i=e.height,a=e.color,d=e.font,s=e.fontSize,c='<svg xmlns="http://www.w3.org/2000/svg" width="'+r+'px" height="'+i+'px">\n                <text x="'+n+'px" y="'+o+'px" dy="'+s+'px"\n                    text-anchor="start"\n                    stroke="'+a+'"\n                    stroke-opacity="'+e.alpha+'"\n                    fill="none"\n                    transform="rotate('+e.angle+","+n+" "+o+')"\n                    font-weight="100"\n                    font-size="'+s+'"\n                    font-family="'+d+'"\n                    >\n                    '+t+"\n                </text>\n            </svg>";return"data:image/svg+xml;base64,"+window.btoa(unescape(encodeURIComponent(c)))}}]),t}(),r="__gwm_"+ +new Date,c=window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver;var t=function(t,n){if(!c)return o=t,r=n,(e=["DOMAttrModified","DOMAttributeNameChanged","DOMCharacterDataModified","DOMElementNameChanged","DOMNodeInserted","DOMNodeInsertedIntoDocument","DOMNodeRemoved","DOMNodeRemovedFromDocument","DOMSubtreeModified"]).map(function(e){return o.addEventListener(e,function(){return r()},!1)}),document.body.addEventListener("DOMSubtreeModified",function(){return r()},!1),{bodyObserver:{disconnect:function(){return document.body.removeEventListener("DOMSubtreeModified",function(){return r()},!1)}},observer:{disconnect:function(){return e.map(function(e){return o.removeEventListener(e,function(){return r()},!1)})}}};var o,r,e,i=new c(function(e){return e.forEach(function(e){return e.removedNodes.forEach(function(e){return e===t&&n()})})});i.observe(document.body,{childList:!0});var a=new c(n);return a.observe(t,{characterData:!0,attributes:!0,childList:!0,subtree:!0}),{bodyObserver:i,observer:a}},o=function(e){return e.disconnect()},u=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.gwmDom?e.gwmDom:document.getElementById(r);t&&document.body.removeChild(t);var n=document.createElement("div"),o={position:"fixed",top:0,right:0,bottom:0,left:0,overflow:"hidden",zIndex:-10,backgroundRepeat:"no-repeat"};return"pointerEvents"in document.documentElement.style&&(o=Object.assign(o,{pointerEvents:"none",zIndex:999999})),l(n,o),n.id=r,n},h="canvas",f="element";return new(function(){function e(){O(this,e)}return n(e,[{key:"creation",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};this.opts=e,this.cancel();var t=e.mode,n=e.watch;this.gwmDom=u(this);var o=function(e,t){var n=[h,"svg",f],o=null;switch(e&&(e=e.toLowerCase(),e=0<=n.indexOf(e)?e:""),e||(e="svg"),e){case h:o=new a(t);break;case"svg":o=new s(t);break;default:o=new d(t)}return o}(t,new i(e)).render();t===f?this.gwmDom.appendChild(o):this.gwmDom.style.background='url("'+o+'")';var r=document.body.firstChild;r?document.body.insertBefore(this.gwmDom,r):document.body.appendChild(this.gwmDom),!1!==n&&(this.observer=this.observing())}},{key:"observing",value:function(){var e=this;return t(this.gwmDom,function(){return e.creation(e.opts)})}},{key:"cancel",value:function(){this.observer&&(o(this.observer.bodyObserver),o(this.observer.observer))}}]),e}())});
